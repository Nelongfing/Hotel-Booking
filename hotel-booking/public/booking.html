<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Book Hotel</title>
<style>
body { font-family: Arial; background:#f5f7fa; display:flex; justify-content:center; align-items:center; height:100vh; margin:0; }
.container { background:#fff; padding:20px; border-radius:10px; width:400px; box-shadow:0 4px 12px rgba(0,0,0,0.1); }
h2 { text-align:center; margin-bottom:20px; }
label { display:block; margin:10px 0 5px; font-weight:bold; }
input, textarea, button { width:100%; padding:8px; border-radius:6px; border:1px solid #ccc; margin-bottom:10px; }
button { background:#007bff; color:white; border:none; font-weight:bold; cursor:pointer; }
button:hover { background:#0056b3; }
</style>
</head>
<body>
<div class="container">
<h2 id="hotelName">Booking</h2>

<label>Number of Guests:</label>
<input type="number" id="guests" min="1" value="1">

<label>Check-in Date:</label>
<input type="date" id="checkin">

<label>Check-out Date:</label>
<input type="date" id="checkout">

<label>Email:</label>
<input type="email" id="email">

<label>Special Requests:</label>
<textarea id="requests" rows="3" placeholder="Any requests..."></textarea>

<button id="confirmBooking">Confirm & Pay</button>
</div>

<script>
const urlParams = new URLSearchParams(window.location.search);
const hotelName = urlParams.get("hotel") || "Hotel";
document.getElementById("hotelName").innerText = `Booking: ${hotelName}`;

document.getElementById("confirmBooking").addEventListener("click", async () => {
  const guests = document.getElementById("guests").value;
  const checkin = document.getElementById("checkin").value;
  const checkout = document.getElementById("checkout").value;
  const email = document.getElementById("email").value;
  const requests = document.getElementById("requests").value;

  if (!checkin || !checkout || !email) {
    alert("Please fill in all required fields.");
    return;
  }

  const nights = Math.max(1, (new Date(checkout) - new Date(checkin))/(1000*60*60*24));
  const total = nights * 5000;

  try {
    const res = await fetch("/bookings", {
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body:JSON.stringify({ hotelName, guests, checkin, checkout, requests, total, email })
    });
    const data = await res.json();

    if (data.approveUrl) {
      localStorage.setItem("pendingBookingId", data.bookingId);
      localStorage.setItem("pendingBookingEmail", email);
      window.location.href = data.approveUrl;
    } else {
      alert("Booking created but payment link missing.");
      console.log(data);
    }
  } catch(err) {
    console.error(err);
    alert("Failed to create booking.");
  }
});
</script>
</body>
</html>
